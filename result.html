<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="max-age=3600, public">
    <title>曼德雷常驻民画像结果</title>
    
    <!-- DNS预解析 -->
    <link rel="dns-prefetch" href="https://cdn.bootcdn.net">
    <link rel="dns-prefetch" href="https://cdn.staticfile.org">
    
    <!-- 预连接 -->
    <link rel="preconnect" href="https://cdn.bootcdn.net" crossorigin>
    <link rel="preconnect" href="https://cdn.staticfile.org" crossorigin>
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="styles.css" as="style">
    
    <!-- 主CSS - 多CDN备用 -->
    <link rel="stylesheet" href="styles.css" onerror="loadFallbackCSS()">
    
    <script>
        // 多CDN备用源
        const cssCDNs = [
            'https://cdn.bootcdn.net/ajax/libs/manderley-css/1.0.0/styles.min.css',
            'https://cdn.staticfile.org/manderley-css/1.0.0/styles.min.css',
            'https://cdn.jsdelivr.net/gh/juliengogh/manderley@main/styles.css'
        ];
        
        // 加载备用CSS
        function loadFallbackCSS() {
            let loaded = false;
            for (const cdn of cssCDNs) {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = cdn;
                link.onerror = () => {};
                document.head.appendChild(link);
                loaded = true;
                break;
            }
            
            if (!loaded) {
                // 内联关键CSS
                const style = document.createElement('style');
                style.textContent = `
                    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #000; color: #fff; }
                    #result-container { margin: 20px auto; padding: 15px; max-width: 90%; }
                    button { padding: 10px 20px; background: #28a745; color: #fff; border: none; border-radius: 5px; }
                    .recommendation { color: #ffcc00; }
                `;
                document.head.appendChild(style);
            }
        }
        
        // 超时处理
        let resourceTimeout = setTimeout(function() {
            if (document.getElementById('loading').style.display !== 'none') {
                document.getElementById('loading').innerHTML = 
                    '<div style="color:#fff;text-align:center;padding:20px;">' +
                    '   <p>加载遇到问题，请尝试：</p>' +
                    '   <p>1. 切换网络(WiFi/4G/5G)</p>' +
                    '   <p>2. 稍后再试</p>' +
                    '   <button onclick="window.location.reload()" style="padding:10px 20px;margin-top:20px;background:#007bff;color:#fff;border:none;border-radius:5px;">重新加载</button>' +
                    '</div>';
            }
        }, 5000);
        
        // 清除超时
        window.addEventListener('load', function() {
            clearTimeout(resourceTimeout);
            document.getElementById('loading').style.display = 'none';
            
            // 检查CSS是否加载成功
            const stylesheets = Array.from(document.styleSheets);
            const cssLoaded = stylesheets.some(sheet => {
                try {
                    return sheet.cssRules.length > 0;
                } catch (e) {
                    return false;
                }
            });
            
            if (!cssLoaded) {
                loadFallbackCSS();
            }
        });
    </script>
</head>
<body>
    <!-- 加载指示器 -->
    <div id="loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:9999;display:flex;justify-content:center;align-items:center;">
        <div style="color:#fff;font-size:20px;">加载中...</div>
    </div>
    
    <div id="result-container">
        <h1>你的今日曼德雷常驻民画像：</h1>
        <div id="result"></div>
        <button onclick="window.location.href = 'index.html'">重新测试</button>
    </div>
    
    <script>
        // 从URL参数中获取角色
        const urlParams = new URLSearchParams(window.location.search);
        const role = urlParams.get('role');

        // 根据角色显示对应的内容
        const resultElement = document.getElementById('result');
        let resultText = '';

        switch (role) {
            case '麦克白':
                resultText = `
                    不甘平凡，刚烈勇猛，行动力强<br>
                    推荐人物：<span class="recommendation">麦克白</span>
                `;
                break;
            case '赫卡忒':
                resultText = `
                    心思缜密，善于计划，冷静魅惑<br>
                    推荐人物：<span class="recommendation">赫卡忒</span>
                `;
                break;
            case '凯瑟琳·坎贝尔':
                resultText = `
                    严谨细致，聪明过人，稳重实干<br>
                    推荐人物：<span class="recommendation">凯瑟琳·坎贝尔</span>
                `;
                break;
            case '艾格尼丝·纳史密斯':
                resultText = `
                    隐忍内敛，务实求真 ，沉稳专一<br>
                    推荐人物：<span class="recommendation">艾格尼丝·纳史密斯</span>
                `;
                break;
            case '青蛇':
                resultText = `
                    个性鲜明，敢作敢为，自信独立<br>
                    推荐人物：<span class="recommendation">青蛇</span>
                `;
                break;
            case '白蛇':
                resultText = `
                    温柔善良，坚韧执着，理想浪漫<br>
                    推荐人物：<span class="recommendation">白蛇</span>
                `;
                break;
            default:
                resultText = '未知结果，请重新测试';
        }

        // 显示结果
        resultElement.innerHTML = resultText;
        
        // 存储结果到本地，减少重复计算
        if (role) {
            try {
                localStorage.setItem('manderley_last_result', role);
            } catch (e) {
                // 忽略本地存储错误
            }
        }
    </script>
</body>
</html>
